---
title: "Swift - MVVM: RxSwiftì™€ Input/Output íŒ¨í„´ ì ìš©"
date: 2022-10-08
categories:
  - iOS
tags:
  - iOS
  - MVVM
  - RxSwift
use_math: true
toc: true
toc_sticky: true
---
<br>

ê¸°ë³¸ì ìœ¼ë¡œ ì• í”Œì—ì„œëŠ” **MVC**ë¥¼ ì§€ì›í•´ì¤€ë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ê¸°ì—ëŠ”... ì¢€ ë¹¡ì„¸ë‹¤  
MVCëŠ” **Model**, **View Controller**ì˜ ì¡°í•©ì¸ë° ì´ë ‡ê²Œ ë˜ë©´ ViewControllerì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê¹Œì§€ ì „ë¶€ ë‹´ê²Œ ë˜ë¯€ë¡œ, ì½”ë“œê°€ ë°©ëŒ€í•´ì§€ê³  ì½ê¸° í˜ë“¤ì–´ì§€ëŠ” ë¬¸ì œê°€ ìˆë‹¤.  

ë‚˜ë„ ì²˜ìŒì— í˜¼ì í† ì´ í”„ë¡œì íŠ¸ë¡œ ê°œë°œí•  ë•ŒëŠ” MVCë¥¼ ì¼ì—ˆë‹¤. ì´ ë•ŒëŠ” í”„ë¡œì íŠ¸ ê·œëª¨ë„ ì‘ì€ í¸ì´ê³ , ì½”ë“œê°€ ì•”ë§Œ ê¸¸ì–´ë„ ë‚´ê°€ ì“´ ê±°ë‹ˆê¹Œ ê·¸ëƒ¥ ì½í˜€ì„œ ìƒê´€ì—†ì—ˆë‹¤.  
ê·¸ëŸ°ë° ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¡œ í˜‘ì—…ì„ í•˜ê²Œ ë˜ë©´ì„œ, í”„ë¡œì íŠ¸ ê·œëª¨ë„ ì»¤ì§€ê³ , ë‚¨ë“¤ê³¼ ë¯¸ë˜ì˜ ë‚˜(ìœ ì§€ë³´ìˆ˜)ë„ ë‚´ ì½”ë“œë¥¼ ë¹ ë¥´ê²Œ íŒŒì•…í•  ìˆ˜ ìˆì–´ì•¼ í–ˆë‹¤. ê·¸ë˜ì„œ í•´ë‹¹ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•  ë•ŒëŠ” ì²˜ìŒë¶€í„° **MVVM** íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³ , êµ¬ì¡°ë„ ì „ì²´ì ìœ¼ë¡œ ì§œê³ , POPë„ ì ìš©í•˜ë©° ì‹œì‘í–ˆì—ˆë‹¤.  

ì ë‹¤ë³´ë‹ˆ ì™œ ì• í”Œì€ ê¾¸ì§„ MVCë¥¼ ì§€ì›í•˜ë‚˜? ìƒê°í•´ ë´¤ëŠ”ë°, ê¸°ì¡´ì—ëŠ” ìŠ¤í† ë¦¬ë³´ë“œë¥¼ ì‚¬ìš©í•´ì„œ ë·°ë¥¼ ë‹¤ ì§œê³ , ì„¸ì„¸í•œ ë·°ë‚˜ ë¡œì§ë§Œ ì½”ë“œë¡œ VCì—ë‹¤ ì‘ì„±í•˜ëŠ” ë°©ì‹ì´ ì£¼ì˜€ê¸° ë•Œë¬¸ì— ê·¸ëŸ° ê²ƒ ê°™ê¸´ í•˜ë‹¤.  
ìš”ìƒˆëŠ” ìŠ¤í† ë¦¬ë³´ë“œ ì—†ì´ UIKitìœ¼ë¡œ ì½”ë“œë¡œë§Œ ë·°ë¥¼ ì§œê¸°ë„ í•˜ê³ , ì´ì   SwiftUIë„ ë‚˜ì™”ìœ¼ë‹ˆ MVCëŠ” ì‚¬ì¥ë˜ì§€ ì•Šì„ê¹Œìš”??  

<br>

## MVVM ì•„í‚¤í…ì²˜

ì•”íŠ¼ MVVMì€ **Model**, **View**, **View Model**ì˜ ì¡°í•©ì´ë‹¤. ë”°ë¼ì„œ ëª¨ë¸ì€ ëª¨ë¸ë§Œ ê´€ì—¬í•˜ê³ , ë·°ëŠ” ë·°ë§Œ ê´€ì—¬í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ View Modelì—ì„œ ë‹¤ ë‹´ë‹¹í•œë‹¤. ì¦‰ ëª¨ë¸ê³¼ ë·°ì˜ ì¤‘ê³„ ì—­í• ì´ë¼ ë³´ë©´ ë˜ê² ë‹¤.  

### ì˜ˆì‹œ
ê°„ë‹¨í•˜ê²Œ, ì´ë©”ì¼ì„ ì…ë ¥ë°›ëŠ” `emailTextField`ì™€, ì…ë ¥ë°›ì€ ì´ë©”ì¼ì˜ validation ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” `emailValidationLabel`ì´ ìˆë‹¤ê³  ë³´ì.

#### 1. êµ¬ì¡°
```swift
class RegisterViewController: UIViewController {
    let disposeBag = DisposeBag()
    let viewModel = RegisterViewModel()
    
    lazy var emailTextField = UITextField()
    lazy var emailValidationLabel = UILabel()
}
```
ê·¸ëŸ¼ ë·°ì»¨ì€ ì´ë ‡ê²Œ ê°€ì§€ê³  ìˆì„ ê±°ê³ 

```swift
class RegisterViewModel {
    let disposeBag = DisposeBag()
    let emailRelay = BehaviorRelay<String?>(value: "")
    let emailLabelRelay = BehaviorRelay<String?>(value: "")
}
```
ë·°ëª¨ë¸ì€ ì´ëŸ° ì‹ìœ¼ë¡œ ë  ê±°ë‹¤.

#### 2. ë°”ì¸ë”©
```swift
class RegisterViewController: UIViewController {
    func setupBindings() {
        // Input
        emailTextField.rx.text
            .bind(to: viewModel.emailRelay)
            .disposed(by: disposeBag)
        
        // Output
        viewModel.emailLabelRelay
            .bind(to: emailLabel.rx.text)
            .disposed(by: disposeBag)
    }
}
```
ë·°ì»¨ì—ì„œëŠ” ë·° ëª¨ë¸ì˜ ë¦´ë ˆì´ì™€ ë°”ì¸ë”©ì„ í•´ì¤˜ì•¼ í•œë‹¤. emailTextFieldì— text ì…ë ¥ì´ ë“¤ì–´ì˜¤ë©´ viewModelì˜ emailRelayì— ë³´ë‚´ì¤˜ì•¼ í•˜ë¯€ë¡œ, ì´ë¥¼ ë°”ì¸ë”© í•œë‹¤.  
ë˜, ë·° ëª¨ë¸ì˜ emailLabelRelayê°€ ë°”ë€Œë©´ ì´ ê°’ì€ emailLabelì˜ textì— ì ìš©ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì´ë¥¼ ë˜ ë°”ì¸ë”©í•´ì¤€ë‹¤.

```swift
class RegisterViewModel {
    init() {
        emailRelay
          .map { getEmailValidationString($0) }
          .bind(to: emailLabelRelay)
          .disposed(by: disposeBag)
    }
}
```
ë·° ëª¨ë¸ì—ì„œëŠ” emailRelayì— ì…ë ¥ì´ ë“¤ì–´ì˜¤ë©´ ì´ì— validationì„ ìˆ˜í–‰í•˜ê³ , ê²°ê³¼ë¥¼ emailLabelRelayì— ë³´ë‚´ë©´ ëœë‹¤.

| ViewController	 | Input/Output	 | ViewModel	 |
| :--: | :--: | :--: |
| emailTextFieldì˜ text ì…ë ¥	 | â†’	 | emailRelay	 |
| 	 | 	 | â†“<br>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§<br>â†“	 |
| emailValidationLabelì˜ ê²°ê³¼ ì¶œë ¥	 | â†	 | emailLabelRelay	 |

ì¦‰ ìœ„ì™€ ê°™ì€ êµ¬ì¡°.

<br>

## Input/Output íŒ¨í„´

ê·¸ëŸ°ë° ì´ëŸ° MVVM íŒ¨í„´ ìì²´ë„ êµ¬í˜„ ë°©ì‹ì´ ë‹¤ì–‘í•œ í¸ì´ë”ë¼. ê·¸ë˜ì„œ ê·¸ ì¤‘ì—ì„œ ì œì¼ ë§ˆìŒì— ë“¤ê³ , ì§€ê¸ˆ í”„ë¡œì íŠ¸ì—ì„œ ì ìš©í•˜ê³  ìˆëŠ” Input/Output íŒ¨í„´ì„ ì •ë¦¬í•œë‹¤.

MVVM ì•„í‚¤í…ì²˜ì—ì„œ RxSwiftë¥¼ ì‚¬ìš©í•  ë•Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì¢€ ë” ì‰½ê²Œ êµ¬ë¶„í•´ë‚´ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ì´ë‹¤.

ëª¨ë“  ViewModelë“¤ì€ ê°ìê°€ ì •ì˜í•œ Inputê³¼ Outputì´ ìˆë‹¤.

- Input
    - Viewì—ì„œ ViewModelë¡œ ì „ë‹¬ë˜ëŠ” Input
- Output
    - ViewModelì—ì„œ Viewë¡œ ì „ë‹¬í•  Output

### êµ¬í˜„

```swift
protocol ViewModel {
    associatedtype Input
    associatedtype Output
    
    var disposeBag: DisposeBag { get set }
    
    func transform(input: Input) -> Output
}
```
POP(Protocol-Oriented Programming)ì— ë”°ë¼ `protocol ViewModel`ì„ ì„ ì–¸í•œë‹¤.  
ë·°ì—ì„œì˜ ì…ë ¥ì€ ëª¨ë‘ `Input`ì— ì •ì˜í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì¶œë ¥ì€ `Output`ì— ì •ì˜í•˜ë©´ ëœë‹¤.
ë˜, ê·¸ëŸ¬í•œ `Input`ì—ì„œ `Output`ìœ¼ë¡œì˜ ë³€í™˜ ê³¼ì •ì€ `transform()`ì—ì„œ ìˆ˜í–‰í•˜ë©´ ëœë‹¤.

```swift
class RegisterViewModel: ViewModel {
    struct Input {
        let emailTextField: Observable<String?>
    }
    
    struct Output {
        let emailLabel: Observable<String?>
    }
    
    var disposeBag = DisposeBag()
    
    let emailRelay = BehaviorRelay<String?>(value: "")
    let emailLabelRelay = BehaviorRelay<String?>(value: "")
}
```
[ìœ„ ì˜ˆì‹œ](#ì˜ˆì‹œ)ì—ì„œì™€ ê°™ì€ ì˜ˆë¥¼ ë³´ì.  
í”„ë¡œí† ì½œì— ì¡´ì¬í•˜ë˜ ì œë„¤ë¦­ íƒ€ì… Inputê³¼ Outputì„ í•„ìš”ì— ë”°ë¼ ì •ì˜í•œë‹¤.

```swift
// In ViewModel.
    func transform(input: Input) -> Output {
        input.emailTextField
            .bind(to: emailRelay)
            .disposed(by: disposeBag)
        
        emailRelay
            .map { getEmailValidationString($0) }
            .bind(to: emailLabelRelay)
            .disposed(by: disposeBag)
        
        return Output(emailLabel: emailLabelRelay.asObservable())
    }
```

ViewModelì—ì„œ Inputì„ Outputìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜í•´ì¤€ë‹¤.  

ì´ì œ `protocol ViewModel`ì„ ë”°ë¥´ê²Œ ëœë‹¤.  
ViewModelì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë”°ë¼ Inputì„ ì²˜ë¦¬í•˜ê³ , Outputì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.

#### ì‚¬ìš©

```swift
// In ViewController.
private func setupBindings() {
    let input = RegisterViewModel.Input(emailTextField: emailTextField.rx.text)

    let output = viewModel.transform(input: input)
    output.emailLabel
         .bind(to: emailLabel.rx.text)
         .disposed(by: disposeBag)
}
```
ì‚¬ìš©í•  ë•ŒëŠ” ì¸í’‹ì„ ë„£ì–´ì£¼ê³ , ì•„ì›ƒí’‹ì„ ë°›ì•„ì™€ ê°ê° ë°”ì¸ë”©ì„ í•´ì£¼ë©´ ëœë‹¤.

### ğŸ’¡â—Â ì¥ì 
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ Inputì´ `emailTextField`ì„ì„ í•œ ëˆˆì— ë³¼ ìˆ˜ ìˆë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ Outputì´ ì–´ë–»ê²Œ ì“°ì´ëŠ” ì§€ í•œ ëˆˆì— ë³¼ ìˆ˜ ìˆë‹¤.
  - ì¦‰ ì´ ë·°ê°€ í•˜ëŠ” ì¼, ë°ì´í„°ì˜ íë¦„ì´ í•œ ëˆˆì— ë³´ì—¬ì„œ ìœ ì§€ë³´ìˆ˜ë„ ì¢‹ë‹¤.
- POPì— ê¸°ì¤€í•˜ì—¬ Inputê³¼ Outputì´ ëª…ì‹œì ìœ¼ë¡œ ë³´ì´ê¸° ë•Œë¬¸ì—, ë·°ì»¨ì—ì„œëŠ” ë·°ëª¨ë¸ì´ ë‚´ë¶€ì—ì„œ ë¬´ìŠ¨ ì§“ì„ í•˜ëŠ” ì§€ ì „í˜€ ì•Œ í•„ìš”ê°€ ì—†ë‹¤.
  - ê·¸ëƒ¥ ê²°ê³¼ë§Œ ê°–ë‹¤ ì“°ë©´ ë¨~~
  - ì´ ì ì´ íŠ¹íˆ í¸í•œ ê²Œ ë·°ëª¨ë¸ ë‚´ë¶€ í”„ë¡œí¼í‹°ë‚˜ í•¨ìˆ˜ëŠ” private ë‹¤ ë¶™ì´ë©´ ë·°ì»¨ì—ì„œëŠ” `transform`ì„ í†µí•œ Outputë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ ì½ê³  ì‚¬ìš©í•˜ê¸° ì¢‹ë‹¤.

<br>

---

êµ¿  
RxSwiftë„ ì •ë¦¬í–ˆë˜ ê±° ì˜¬ë ¤ì•¼ ê² ë‹¤
<br>
